{% extends '::admin_header.html.twig' %}

{% block body -%}
    <div id="modalImageList" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Choix du fichier</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12 lister">

                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    <div class="row">
        <div class="col-lg-12">
            <h1>Ajouter une image au slide show en page d'accueil</h1>
            <ol class="breadcrumb">
                <li class="active"><i class="fa fa-dashboard"></i> Image</li>
            </ol>
        </div>
    </div><!-- /.row -->


    <div class="row">

        <div class="col-lg-12">
            {{ form_start(form) }}
            {{ form_errors(form) }}
        </div>

        <div class="col-lg-12">

            <div class="row">
                <div class="col-lg-4">
                    {{ form_label(form.file) }}
                    <img id="preview" src="http://placehold.it/1170x450" width="195" height="75">
                </div>
                <div class="col-lg-8">
                    <div class="form-group input-group">
                        <span class="input-group-addon"><i class="fa fa-picture-o"></i></span>
                        {{ form_widget(form.file) }}
                        {{ form_widget(form.imageExistante) }}
                    </div>
                    <div class="form-group input-group">
                        <span class="input-group-addon"><i class="fa fa-archive"></i></span>
                        <button class="form-control btn btn-default imageLister" data-toggle="modal" data-target="#modalImageList">Utiliser une image existante</button>
                    </div>
                </div>
            </div>


        </div>
        <div class="col-lg-12">
            <div class="form-group">
                {{ form_label(form.titre) }}
                {{ form_errors(form.titre) }}
                {{ form_widget(form.titre, {'attr': {'class': 'form-control'}}) }}
            </div>

            <div class="form-group">
                {{ form_label(form.date) }}
                {{ form_errors(form.date) }}
                {{ form_widget(form.date, {'attr': {'class': 'form-control '}}) }}
            </div>
            <div class="form-group">
                {{ form_label(form.realisation) }}
                {{ form_errors(form.realisation) }}
                {{ form_widget(form.realisation, {'attr': {'class': 'form-control '}}) }}
            </div>

            <div class="form-group">
                {{ form_widget(form.submit, {'attr': {'class': 'btn btn-success'}}) }}
                <br>
                <a href="{{ path('admin_diaporama') }}" class="btn btn-default pull-right">
                    Retourner Ã  la liste
                </a>
            </div>
            {{ form_end(form) }}
        </div>

    </div>
{% endblock %}

{% block footerScript %}
    {{ parent () }}
    <script type="text/javascript">
        $(document).ready(function() {



            $('.imageLister').on('click',function(event){
                event.preventDefault();
                var btLister=$(this);
                console.log('oki');
                $.post('{{ path('bo_media_list',{'rootdirname':diaporama.repMedia}) }}',function(data){
                    console.log('oki post');
                    $('.lister').html(data).find('img').on('click', function(){
                        var zonePreview=$(btLister).data('preview');
                        var imageExistante=$(btLister).data('input');
                        console.log(zonePreview+"-"+imageExistante);
                        $('.'+zonePreview).attr('src',$(this).attr('src'));
                        $('.'+imageExistante).val($(this).attr('src'));
                    })
                    $('.lister').find('.rep h5').on('click',function(){
                        $(this).parent().find('>div').toggle();
                        $(this).find('i').toggleClass('fa-folder-open','fa-folder')
                    });
                })
            });
            $('.upload-image').change(function() {
                var file = $(this);

                var zonePreview=$(this).data('preview');
                var imageExistante=$(this).data('input');

                var preview = $('.'+zonePreview);

                var largeur=preview.width();
                var hauteur=preview.height();

                //maj de l'input text hidden
                $('.'+imageExistante).val('new');

                var reader = new FileReader;
                reader.onload = function(event) {
                    var img = new Image();
                    img.onload = function() {

                        var canvas = $('<canvas></canvas>').attr({ width: largeur, height: hauteur });
                        preview.hide();
                        preview.after(canvas);
                        var context = canvas[0].getContext('2d');
                        context.drawImage(img, 0, 0, largeur, hauteur);
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file[0].files[0]);
            });
        });
    </script>
{% endblock footerScript %}

